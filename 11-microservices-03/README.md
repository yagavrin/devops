
# Домашнее задание к занятию «Микросервисы: масштабирование»

## Задача 1: Кластеризация

Предложите решение для обеспечения развёртывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение: Использование Kubernetes в сочетании с Helm, NGINX Ingress Controller, Prometheus, Grafana, HashiCorp Vault и GitLab CI/CD.
Компоненты и их взаимодействие:

1) Kubernetes (основа оркестрации)

  * Поддержка контейнеров: Нативный инструмент для управления контейнерами (Docker, containerd).

  * Обнаружение сервисов: Встроенный DNS и Service-ресурсы автоматически регистрируют сервисы.

  * Горизонтальное масштабирование: Ручное масштабирование через kubectl scale, автоматическое — через Horizontal Pod Autoscaler.

  * Автоматическое масштабирование кластера: Cluster Autoscaler добавляет/удаляет ноды в облачном провайдере.

  * Разделение ресурсов:

    * Внешний доступ: Ingress (NGINX Ingress Controller) маршрутизирует внешние запросы.

    * Внутренние сервисы: Используются с типом ClusterIP, доступные только внутри кластера.

    * Network Policies ограничивают трафик между подами.

2) Helm (управление конфигурацией)

  * Упрощает установку и настройку приложений через чарты.

  * Интегрируется с ConfigMaps и Secrets Kubernetes для управления переменными среды.

3) HashiCorp Vault (безопасное хранение секретов)

  * Хранит пароли, ключи, сертификаты.

  * Интеграция с Kubernetes через Vault Agent Injector: автоматически обновляет секреты в подах.

4) Prometheus + Grafana (мониторинг и автоматическое масштабирование)

  * Prometheus собирает метрики (CPU, RAM, запросы).

  * Autoscaler использует метрики для автоматического масштабирования подов.

  * Grafana визуализирует данные для анализа.

1) GitLab CI/CD (развертывание)

  * Автоматизирует сборку образов (Docker), тестирование и деплой в Kubernetes через Kubernetes Runner.

  * Реализует GitOps: изменения в репозитории триггерят обновления в кластере.

#### Обоснование выбора:

  * Kubernetes: Стандарт для оркестрации контейнеров с поддержкой всех требуемых функций (масштабирование, обнаружение сервисов).

  * Helm: Упрощает управление сложными конфигурациями и зависимостями.

  * Vault: Обеспечивает безопасное хранение секретов, включая ротацию и аудит.

  * Prometheus/Grafana: инструменты для мониторинга с открытым исходным кодом.

  * GitLab CI/CD: Единая платформа для CI/CD с глубокой интеграцией с Kubernetes.

## Задача 2: Распределённый кеш * (необязательная)

Порядок запуска:

1) Запустить скрипт для создания конфигурационных файлов: `init_redis_config.sh`

4) Запустить контейнеры для кластера: `docker compose up -d`

7) Объединить контейнеры в единый кластер:

```
docker run -it --rm --net redis-cluster-net redis:7.2-alpine \
  redis-cli --cluster create \
  redis-7000:7000 redis-7001:7001 redis-7002:7002 \
  redis-7003:7003 redis-7004:7004 redis-7005:7005 \
  redis-7006:7006 redis-7007:7007 redis-7008:7008 \
  --cluster-replicas 2
```

4) Проверить кластер: `docker exec -it redis-7000 redis-cli -p 7000 cluster info`
