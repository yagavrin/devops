# Домашнее задание к занятию «Компоненты Kubernetes»

### Задание. Необходимо определить требуемые ресурсы
Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
3. Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии. 
4. Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий. 
5. Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

### Оптимальные варианты размещения:

#### 7 нод 4 CPU/8 RAM. 

Распределение по нодам: 3 ноды с БД, 3 ноды с кешем, бекенд и фронтенд равномерно распределены (либо часть на 7й свободной ноде)

| Компонент  | ОЗУ (ГБ) |
|------------|------------:|
| БД/Кеш    |        4.00 |
| Фронтенд  |        0.05 |
| Бекенд (х2)   |        1.20 |
| Kubelet   |        1.80 |
| **Итого** |      **7.05** |

| Компонент  | ЦПУ |
|------------|------------:|
| БД/Кеш    |        1.00 |
| Фронтенд  |        0.20 |
| Бекенд (х2)   |        2.00 |
| Kubelet   |        0.72 |
| **Итого** |      **3.27** |

При таком варианте получается 6 рабочих нод и одна запасная, на которой размещаются поды с упавшей ноды. На ноде остается запас примерно 0.9 гб памяти и 0.7 цпу. 

Стоимость на яндекс клауде **5451** руб за ноду, стоимость кластера **38 157** руб

#### 6 нод 6 CPU/12 RAM. 

Распределение по нодам: 3 ноды с БД, 3 ноды с кешем, бекенд и фронтенд равномерно распределены

| Компонент  | ОЗУ (ГБ) |
|------------|------------:|
| БД/Кеш    |        4.00 |
| Фронтенд  |        0.05 |
| Бекенд (х2)    |        1.20 |
| Kubelet   |        2.20 |
| **Итого** |      **7.45** |

| Компонент  | ЦПУ |
|------------|------------:|
| БД/Кеш    |        1.00 |
| Фронтенд  |        0.20 |
| Бекенд (х2)   |        2.00 |
| Kubelet   |        0.85 |
| **Итого** |      **3.285** |

При таком варианте получается 6 рабочих нод, поды упавшей ноды распределяются между оставщимися нодами. На ноде остается запас примерно 4.5 гб памяти и 2.7 цпу в обычном состоянии и 0.5гб памяти и 1.7 цпу при переезде подов с упавшей ноды 

Стоимость на яндекс клауде **7955** руб за ноду, стоимость кластера **47 730** руб

* При варианте 4 CPU/8 RAM свободных ресурсов в кластере остается "впритык" и если упадут две ноды, поды со второй будет уже негде размещать. Также не остается ресурсов для масштабирования. Однако добавление в кластер еще одной ноды будет всё еще дешевле чем 6/12. 
* Вариант 6 CPU/12 RAM выглядит лучше с точки зрения отказооустойчивости (есть запас для размещения нескольких упавших нод) и для быстрого масштабирования ( не нужно поднимать доп. ноду, достаточно развернуть больше реплик), однако намного дороже. Поэтому выбор оптимального варианта зависит от бюджета и требований к отказоустойчивости.
