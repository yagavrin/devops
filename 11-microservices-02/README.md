
# Домашнее задание к занятию «Микросервисы: принципы»

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

| Характеристика                     | Kong Gateway                  | NGINX                          | Traefik               | Yandex API Gateway          |
|------------------------------------|-------------------------------|--------------------------------|-----------------------|-----------------------------|
| Маршрутизация                      | Да (декларативно + GUI)       | Да (через конфиг / API)        | Да (динамически)      | Да (конфиг yaml + GUI)      |
| Аутентификация (JWT, OAuth2 и др.) | Да (через плагины)            | Частично (через lua / Plus)    | Да (middleware)       | Да                          |
| Терминация HTTPS                   | Да                            | Да                             | Да                    | Да                          |
| Масштабируемость / Cloud Native    | Отлично (Kubernetes)          | Хорошо                         | Отлично (Kubernetes) | Отлично                     |
| Open Source                        | Да (Community Edition)        | Да (OSS версия)                | Да                    | Нет                         |
| Производительность                 | Высокая                       | Очень высокая                  | Высокая              | Высокая                     |
| Поддержка Kubernetes (Ingress)     | Да (Kong Ingress)             | Да (NGINX Ingress)             | Да (Traefik Ingress) | Частично (с Yandex ALB)     |

### Выбор решения: Kong Gateway

Обоснование:

- Гибкость маршрутизации и плагинов: Kong предоставляет богатую систему плагинов, включая проверку токенов (JWT, OAuth2), rate limiting, логирование и др.
- Поддержка терминации HTTPS: Конфигурируется легко, особенно в Kubernetes через Kong Ingress Controller.
- Расширяемость и поддержка микросервисной архитектуры: Полностью совместим с Kubernetes, легко масштабируется, поддерживает service mesh через Kuma (от Kong).
- Поддержка GUI: Наличие бесплатного и платного (Enterprise) интерфейса управления (Konga, Kong Manager).

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

| Характеристика               | Apache Kafka                     | RabbitMQ                        | NATS JetStream                 | Apache Pulsar                   | Redis Streams                  |
|------------------------------|----------------------------------|---------------------------------|--------------------------------|---------------------------------|--------------------------------|
| **Кластеризация и High Availability** | Да (встроено, ZooKeeper/KRaft) | Да (кластер + Quorum queues)    | Да (JetStream + кластер NATS)  | Да (встроено + BookKeeper)      | Да (Redis Cluster)             |
| **Хранение сообщений на диске**       | Да (log-сегменты на диске)      | Да (сообщения и очереди)        | Да (JetStream persistence)     | Да (BookKeeper сегменты)        | Да (но неэффективно при больших объёмах) |
| **Скорость работы (пропускная способность)** | Очень высокая (до 1 млн msg/s) | Высокая (десятки тыс. msg/s)    | Очень высокая (сотни тыс. msg/s) | Очень высокая (на уровне Kafka) | Средняя (в зависимости от сценария) |
| **Поддержка форматов сообщений**      | Любые (байты), Avro, JSON, Protobuf | Любые (байты), JSON, XML     | Байты, JSON, Protobuf          | Байты, Avro, JSON, Protobuf     | Простые строки / JSON          |
| **Разделение прав доступа**           | Да (ACL, SASL, TLS)             | Да (vhost + user perms)         | Да (JetStream + NKEY/Auth)     | Да (многоуровневая аутентификация, JWT) | Да (на уровне ключей/stream)   |
| **Простота эксплуатации**             | Средняя (ZooKeeper / KRaft)     | Высокая (удобный UI, CLI)       | Высокая (легко разворачивается) | Средняя (много компонентов)     | Высокая (если уже есть Redis)  |
| **Поддержка отложенной доставки / повторов** | Да (через Kafka Streams)    | Да (TTL + DLX)                  | Да (встроено)                  | Да (встроено)                 | Ограничено                     |

### Рекомендованное решение: Apache Pulsar

Обоснование:

1. Кластеризация и надёжность: В Pulsar встроенная нативная кластеризация и HA, поддержка многорегиональных репликаций без дополнительных компонентов.

2. Хранение сообщений: Использует Apache BookKeeper, что даёт гибкое и быстрое хранилище с жёсткой фиксацией сообщений на диск, гарантируя доставку.

3. Высокая скорость: Производительность на уровне Kafka, поддерживает миллионы сообщений в секунду с низкой задержкой.

4. Гибкость форматов: Поддерживает любые форматы: JSON, Avro, Protobuf, байтовые массивы. Поддерживает Schema Registry, как и Kafka.

5. Безопасность: Поддержка JWT, TLS, role-based access control, изоляция по namespace’ам и tenant’ам.

6. Простота эксплуатации: Несмотря на сложную архитектуру, есть удобные CLI, REST API, веб-интерфейс и автоматизация через Helm Charts и Terraform. Поддерживается Pulsar Functions — встраиваемая логика обработки сообщений прямо внутри брокера.

## Задача 3: API Gateway * (необязательная)

Обновленный исходный код для задания находится по адресу (обновлен сервис security, compose файл и добавлен nginx конфиг): 

https://github.com/yagavrin/devops/tree/main/11-microservices-02/src

Результат выполнения тестовых команд:

![11-ms-bash](https://github.com/user-attachments/assets/a3b36edf-3995-4b91-988b-722ecba01f8d)


